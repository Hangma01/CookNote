USE TEST2;

-- 테이블 삭제
DROP TABLE `RECIPE_LIKE`;
DROP TABLE `BOOKMARK`;
DROP TABLE `REPORT`;
DROP TABLE `FOLLOW`;
DROP TABLE `RECIPE_INGREDIENT`;
DROP TABLE `RECIPE_SEQ`;
DROP TABLE `CATEGORY_REPORT_REASON`;
DROP TABLE `COMMENT`;
DROP TABLE `RECIPE`;
DROP TABLE `CATEGORY_CUISINE`;
DROP TABLE `CATEGORY_PURPOSE`;
DROP TABLE `USER`;


-- 회원 테이블
CREATE TABLE `USER` (
    `USER_ID` BIGINT AUTO_INCREMENT,								-- 회원 Key
    `ID` VARCHAR(20) NOT NULL,										-- 회원 아이디
	`PASSWORD` VARCHAR(60) NOT NULL,								-- 회원 비밀번호
    `NAME` VARCHAR(20) NOT NULL,									-- 회원 이름
	`NICKNAME` VARCHAR(15) NOT NULL,								-- 회원 닉네임
    `EMAIL` VARCHAR(100) NOT NULL,									-- 회원 이메일
    `PROFILE_IMAGE` VARCHAR(400) NOT NULL,							-- 회원 프로필
    `CREATE_AT` DATETIME NOT NULL DEFAULT NOW(),					-- 회원가입 날짜
    `UPDATE_AT` DATETIME NOT NULL DEFAULT NOW() ON UPDATE NOW(),	-- 회원수정 날짜
    `IS_DELETE` BOOLEAN NOT NULL DEFAULT FALSE,						-- 회원탈퇴 여부
    PRIMARY KEY (`USER_ID`)
);

-- 팔로우 테이블
CREATE TABLE `FOLLOW` (
	`FOLLOWING_ID` BIGINT,											-- 팔로잉(구독한 회원)
	`FOLLOWER_ID` BIGINT,											-- 팔로워(구독당한 회원)
	`CREATE_AT` DATETIME NOT NULL DEFAULT NOW(),					-- 생성일
	PRIMARY KEY (`FOLLOWING_ID`, `FOLLOWER_ID`),
	FOREIGN KEY (`FOLLOWING_ID`) REFERENCES `USER`(`USER_ID`),
	FOREIGN KEY (`FOLLOWER_ID`) REFERENCES `USER`(`USER_ID`)
);

-- 카테고리 신고 사유 종류 테이블
CREATE TABLE `CATEGORY_REPORT_REASON` (
	`CATEGORY_REPORT_REASON_ID` INT AUTO_INCREMENT,					-- 카테고리 신고 사유 종류 Key
	`TYPE` VARCHAR(30) NOT NULL,									-- 종류 
	PRIMARY KEY (`CATEGORY_REPORT_REASON_ID`)
);

-- 신고 테이블
CREATE TABLE `REPORT` (
	`REPORT_ID` BIGINT AUTO_INCREMENT,								-- 신고 테이블 Key
	`TARGET_TYPE` ENUM('RECIPE', 'COMMENT'),						-- 타겟 종류
	`TARGET_ID`	BIGINT,												-- 타겟 아이디
	`STATUS` ENUM('PENDING', 'REJECTED', 'APPROVED'),				-- 신고 처리 상태
	`CREATE_AT` DATETIME NOT NULL DEFAULT NOW(),					-- 생성일
	`REPORTER_ID` BIGINT NOT NULL,									-- 신고자 (FK)
	`CATEGORY_REPORT_REASON_ID` INT NOT NULL,						-- 카테고리 신고 사유 종류 (FK)
	PRIMARY KEY (`REPORT_ID`),
	FOREIGN KEY (`REPORTER_ID`) REFERENCES `USER`(`USER_ID`),
	FOREIGN KEY (`CATEGORY_REPORT_REASON_ID`) REFERENCES `CATEGORY_REPORT_REASON`(`CATEGORY_REPORT_REASON_ID`)
);

-- 카테고리 요리 종류 테이블
CREATE TABLE `CATEGORY_CUISINE` (
	`CATEGORY_CUISINE_ID` INT AUTO_INCREMENT,						-- 카테고리 요리 종류 Key
	`TYPE` VARCHAR(10) NOT NULL,									-- 종류
	PRIMARY KEY (`CATEGORY_CUISINE_ID`)
);

-- 카테고리 목적 종류 테이블
CREATE TABLE `CATEGORY_PURPOSE` (
	`CATEGORY_PURPOSE_ID` INT AUTO_INCREMENT,						-- 카테고리 목적 종류 Key
	`TYPE` VARCHAR(10) NOT NULL,									-- 종류
	PRIMARY KEY (`CATEGORY_PURPOSE_ID`)
);

-- 레시피 테이블
CREATE TABLE `RECIPE` (
	`RECIPE_ID` BIGINT AUTO_INCREMENT,								-- 레시피 Key
	`TITLE` VARCHAR(50) NOT NULL,									-- 레시피 제목
	`THUMBNAIL` VARCHAR(400) NOT NULL,								-- 레시피 썸네일
	`DESCRIPTION` VARCHAR(250) NULL,								-- 레시피 소개
	`SERVING` TINYINT NOT NULL,										-- 인원수
	`DURATION` TINYINT NOT NULL,									-- 요리 시간
	`LEVEL` TINYINT NOT NULL,										-- 요리 난이도
	`VIDEO_ID` VARCHAR(11),											-- 동영상 아이디
	`TIP` VARCHAR(250),												-- 요리 팁
	`STATUS` ENUM('PRIVATE', 'PUBLIC', 'PRIVATE_ADMIN', 'DELETE') 	-- 레시피 상태
			NOT NULL COMMENT '공개, 비공개, 관리자 비공개, 삭제',
	`CREATE_AT` DATETIME NOT NULL DEFAULT NOW(),					-- 생성일
	`UPDATE_AT` DATETIME NOT NULL DEFAULT NOW() ON UPDATE NOW(),	-- 수정일
	`CATEGORY_CUISINE_ID` INT NOT NULL,								-- 카테고리 요리 종류 (FK)
	`CATEGORY_PURPOSE_ID` INT NOT NULL,								-- 카테고리 목적 종류 (FK)
	`WRITER_ID` BIGINT NOT NULL,									-- 작성자 (FK)
	PRIMARY KEY (`RECIPE_ID`),
	FOREIGN KEY (`CATEGORY_CUISINE_ID`) REFERENCES `CATEGORY_CUISINE`(`CATEGORY_CUISINE_ID`),
	FOREIGN KEY (`CATEGORY_PURPOSE_ID`) REFERENCES `CATEGORY_PURPOSE`(`CATEGORY_PURPOSE_ID`),
	FOREIGN KEY (`WRITER_ID`) REFERENCES `USER`(`USER_ID`)
);

-- 레시피 순서 테이블
CREATE TABLE `RECIPE_SEQ` (
	`RECIPE_SEQ_ID` INT AUTO_INCREMENT,								-- 레시피 순서 Key
	`RECIPE_ID` BIGINT NOT NULL,									-- 레시피 Key (복합키)
	`DESCRIPTION` VARCHAR(250) NOT NULL,							-- 레시피 순서별 설명
	`IMAGE` VARCHAR(400),											-- 레시피 순서별 이미지
	PRIMARY KEY (`RECIPE_SEQ_ID`, `RECIPE_ID`),
	FOREIGN KEY (`RECIPE_ID`) REFERENCES `RECIPE`(`RECIPE_ID`)
);

-- 재료 테이블
CREATE TABLE `RECIPE_INGREDIENT` (
	`RECIPE_INGREDIENT_ID` INT AUTO_INCREMENT,						-- 재료 Key
	`NAME` VARCHAR(20) NOT NULL,									-- 재료 이름
	`QUANTITY` VARCHAR(10) NOT NULL,								-- 재료 수량
    `REMARK` VARCHAR(30),											-- 비고
	`RECIPE_ID` BIGINT NOT NULL,									-- 레시피 (FK)
	PRIMARY KEY (`RECIPE_INGREDIENT_ID`),
	FOREIGN KEY (`RECIPE_ID`) REFERENCES `RECIPE`(`RECIPE_ID`)
);

-- 레시피 좋아요 테이블
CREATE TABLE `RECIPE_LIKE` (
	`RECIPE_LIKE_ID` BIGINT AUTO_INCREMENT,							-- 레시피 좋아요 Key
	`USER_ID` BIGINT NOT NULL,										-- 회원 (FK)
	`RECIPE_ID` BIGINT NOT NULL,									-- 레시피 (FK)
	PRIMARY KEY (`RECIPE_LIKE_ID`),
	FOREIGN KEY (`RECIPE_ID`) REFERENCES `RECIPE`(`RECIPE_ID`),
	FOREIGN KEY (`USER_ID`) REFERENCES `USER`(`USER_ID`)
);

-- 레시피 북마크 테이블
CREATE TABLE `BOOKMARK` (
	`BOOKMARK_ID` BIGINT AUTO_INCREMENT,							-- 레시피 북마크 Key,
	`USER_ID` BIGINT NOT NULL,										-- 회원 (FK)
	`RECIPE_ID` BIGINT NOT NULL,									-- 레시피 (FK)
	PRIMARY KEY (`BOOKMARK_ID`),
	FOREIGN KEY (`RECIPE_ID`) REFERENCES `RECIPE`(`RECIPE_ID`),
	FOREIGN KEY (`USER_ID`) REFERENCES `USER`(`USER_ID`)
);

-- 댓글 테이블
CREATE TABLE `COMMENT` (
	`COMMENT_ID` BIGINT AUTO_INCREMENT,								-- 댓글 Key
	`CONTENT` VARCHAR(250) NOT NULL,								-- 댓글 내용
	`STATUS` ENUM('PUBLIC', 'PRIVATE_ADMIN', 'DELETE') NOT NULL,	-- 상태
	`CREATE_AT` DATETIME NOT NULL,									-- 생성일
	`UPDATE_AT` DATETIME NOT NULL DEFAULT NOW() ON UPDATE NOW(),	-- 수정일
	`WRITER_ID` BIGINT NOT NULL,									-- 회원 (FK)
	`RECIPE_ID` BIGINT NOT NULL,									-- 레시피 (FK)
	`PARENT_COMMENT_ID` BIGINT,										-- 부모 COMMENT (FK)
	PRIMARY KEY (`COMMENT_ID`),
	FOREIGN KEY (`WRITER_ID`) REFERENCES `USER`(`USER_ID`),
	FOREIGN KEY (`RECIPE_ID`) REFERENCES `RECIPE`(`RECIPE_ID`),
	FOREIGN KEY (`PARENT_COMMENT_ID`) REFERENCES `COMMENT`(`COMMENT_ID`)
);